@model dynamic
@{
    ViewBag.Title = "個股資訊";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <!-- Stock Detail Section -->
    <div class="row mb-4">
        <div class="col-md-8">
            <!-- K-Line Chart -->
            <div class="chart-container">
                <!-- 標題和按鈕區域 -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5><i class="fas fa-chart-candlestick me-2"></i><span id="stockTitle">載入中...</span> K線圖</h5>

                    <!-- 時間框架按鈕 -->
                    <div class="btn-toolbar flex-wrap" role="toolbar">
                        <!-- 短期分析 -->
                        <div class="btn-group me-2 mb-2" role="group">
                            <button type="button" class="btn btn-sm btn-outline-success" onclick="changeTimeframe('7D')">
                                近5日
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-success" onclick="changeTimeframe('1M')">
                                近1月
                            </button>
                        </div>

                        <!-- 中長期分析 - 分成兩組 -->
                        <div class="btn-group me-2 mb-2" role="group">
                            <button type="button" class="btn btn-sm btn-outline-primary active" onclick="changeTimeframe('3M')">
                                近3月
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="changeTimeframe('6M')">
                                近半年
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="changeTimeframe('1Y')">
                                近1年
                            </button>
                        </div>

                        <div class="btn-group me-2 mb-2" role="group">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="changeTimeframe('2Y')">
                                近2年
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="changeTimeframe('5Y')">
                                近5年
                            </button>
                        </div>

                        <!-- 特殊範圍 -->
                        <div class="btn-group mb-2" role="group">
                            <button type="button" class="btn btn-sm btn-outline-warning" onclick="changeTimeframe('YTD')">
                                年初至今
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="changeTimeframe('MAX')">
                                全部歷史
                            </button>
                        </div>
                    </div>
                </div>

                <!-- K線圖區域 -->
                <div class="position-relative">
                    <!-- 載入指示器 -->
                    <div id="klineLoadingIndicator" class="position-absolute top-50 start-50 translate-middle d-none" style="z-index: 1000;">
                        <div class="bg-white p-3 rounded shadow text-center">
                            <div class="spinner-border text-primary me-2" role="status">
                                <span class="visually-hidden">載入中...</span>
                            </div>
                            <span>載入<span id="loadingTimeframe">資料</span>中，請稍候...</span>
                        </div>
                    </div>

                    <!-- K線圖容器 -->
                    <div id="klineChart" data-stock-id="@ViewBag.StockId"
                         style="width: 800px; height: 550px; background: #fafafa; border: 1px solid #e0e0e0; border-radius: 4px; margin: 0 auto;">
                    </div>
                </div>

                <!-- 資料統計 -->
                <div class="row mt-3">
                    <div class="col-md-8">
                        <small class="text-muted">
                            資料範圍：<span id="dataDateRange">--</span> |
                            交易日數：<span id="tradingDays">--</span>
                        </small>
                    </div>
                    <div class="col-md-4 text-end">
                        <small class="text-muted">
                            最後更新：<span id="lastUpdateTime">--</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- 即時盯盤區 -->
            <div class="card stock-card mb-3 realtime-panel">
                <div class="card-header bg-success text-white">
                    <div class="d-flex justify-content-between">
                        <h6 class="mb-0">
                            <i class="fas fa-broadcast-tower me-2"></i>即時盯盤
                            <small class="realtime-dot" id="realtimeDot" data-stock-id="@ViewBag.StockId">●</small>
                        </h6>
                        <button class="btn btn-sm btn-outline-light" id="toggleMonitor">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- 迷你K線圖 -->
                    <div id="miniKLineChart" style="width: 100%; height: 200px; margin: 0 auto;"></div>

                    <!-- 股價數字資訊放在下方 -->
                    <div class="row mt-2 text-center">
                        <div class="col-6">
                            <small class="text-muted">市價</small>
                            <div class="realtime-price fw-bold" id="realtimePrice">--</div>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">漲跌</small>
                            <div class="realtime-change fw-bold" id="realtimeChange">--</div>
                        </div>
                    </div>

                    <small class="text-muted text-center d-block mt-2">
                        更新時間：<span id="updateTime">--</span>
                    </small>
                </div>
            </div>

            <div class="card stock-card mb-3">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>基本資訊</h6>
                    <button class="btn btn-outline-light btn-sm" onclick="refreshData()">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
                <div class="card-body">
                    <!-- 合併股票資訊+今日統計 -->
                    <div class="row">
                        <div class="col-4">股票代號:</div>
                        <div class="col-8" id="stockId">--</div>
                        <div class="col-4">股票名稱:</div>
                        <div class="col-8" id="stockName">--</div>

                        <div class="col-4">收盤價:</div>
                        <div class="col-4" id="closePrice"><strong>--</strong></div>
                        <div class="col-4" id="dailyChange">--</div>

                        <div class="col-4">開盤:</div>
                        <div class="col-2" id="openPrice">--</div>
                        <div class="col-4">最高:</div>
                        <div class="col-2" id="highPrice">--</div>

                        <div class="col-4">昨收:</div>
                        <div class="col-2" id="prevClose">--</div>
                        <div class="col-4">最低:</div>
                        <div class="col-2" id="lowPrice">--</div>

                        <div class="col-4">成交量:</div>
                        <div class="col-8" id="volume">--</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
